import { fileIo } from '@kit.CoreFileKit';
import { image } from '@kit.ImageKit';
import { Luban, LubanUtils } from 'library';
import { PhotoHelper } from '../utils/PhotoHelper';

interface CompressInfo {
  originalPath: string;
  compressedPath: string;
  originalSize: number;
  compressedSize: number;
  compressionRatio: number;
  imageWidth?: number;
  imageHeight?: number;
}

@Entry
@Component
struct Index {
  @State message: string = 'Luban å›¾ç‰‡å‹ç¼©æ¼”ç¤º'
  @State compressInfo: CompressInfo | null = null
  @State isCompressing: boolean = false
  @State selectedImageUri: string = ''

  build() {
    Scroll() {
      Column() {
        // æ ‡é¢˜
        Text(this.message)
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
          .margin({ top: 20, bottom: 20 })
          .fontColor('#2c3e50')

        // æ“ä½œæŒ‰é’®ç»„
        Row({ space: 12 }) {
          Button('ğŸ“· å•å›¾é€‰æ‹©')
            .width('30%')
            .height(50)
            .enabled(!this.isCompressing)
            .backgroundColor('#3498db')
            .onClick(() => {
              this.selectSingleImageAndCompress()
            })

          Button('ğŸ–¼ï¸ å¤šå›¾é€‰æ‹©')
            .width('30%')
            .height(50)
            .enabled(!this.isCompressing)
            .backgroundColor('#27ae60')
            .onClick(() => {
              this.selectMultipleImagesAndCompress()
            })

          Button('ğŸ“± ä»…æ‹ç…§')
            .width('30%')
            .height(50)
            .enabled(!this.isCompressing)
            .backgroundColor('#e67e22')
            .onClick(() => {
              this.takePhotoAndCompress()
            })
        }
        .width('100%')
        .justifyContent(FlexAlign.SpaceEvenly)
        .margin({ bottom: 20 })

        // åŠ è½½çŠ¶æ€
        if (this.isCompressing) {
          Row() {
            LoadingProgress()
              .width(30)
              .height(30)
              .margin({ right: 10 })
            Text('å‹ç¼©å¤„ç†ä¸­...')
              .fontSize(16)
              .fontColor('#3498db')
          }
          .margin({ bottom: 20 })
        }

        // å›¾ç‰‡é¢„è§ˆå’Œå‹ç¼©ç»“æœ
        if (this.compressInfo) {
          this.buildCompressResultCard()
        }

        // æ“ä½œæŒ‰é’®ç»„
        if (this.compressInfo && !this.isCompressing) {
          Column({ space: 10 }) {
            Row({ space: 12 }) {
              Button('æ¸…é™¤ç»“æœ')
                .width('48%')
                .height(45)
                .type(ButtonType.Normal)
                .backgroundColor('#e74c3c')
                .onClick(() => {
                  this.clearResult()
                })

              Button('æ‰¹é‡å‹ç¼©æ¼”ç¤º')
                .width('48%')
                .height(45)
                .type(ButtonType.Normal)
                .backgroundColor('#9b59b6')
                .onClick(() => {
                  this.showBatchCompressExample()
                })
            }
            .width('100%')
            .justifyContent(FlexAlign.SpaceEvenly)

            // ç¼“å­˜ç®¡ç†æŒ‰é’®
            Button('ğŸ§¹ æ¸…ç†ä¸´æ—¶ç¼“å­˜')
              .width('100%')
              .height(40)
              .type(ButtonType.Normal)
              .backgroundColor('#95a5a6')
              .onClick(() => {
                this.cleanTempCache()
              })
          }
          .width('100%')
          .margin({ top: 20 })
        }

        // ä½¿ç”¨è¯´æ˜
        this.buildInstructions()
      }
      .width('100%')
      .padding({ left: 16, right: 16, bottom: 20 })
    }
    .height('100%')
    .width('100%')
  }

  // æ„å»ºå‹ç¼©ç»“æœå¡ç‰‡
  @Builder
  buildCompressResultCard() {
    Column() {
      Text('ğŸ“Š å‹ç¼©ç»“æœ')
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .margin({ bottom: 15 })
        .fontColor('#2c3e50')

      // å›¾ç‰‡é¢„è§ˆ
      if (this.selectedImageUri) {
        Image(this.selectedImageUri)
          .width('100%')
          .height(200)
          .objectFit(ImageFit.Contain)
          .borderRadius(8)
          .margin({ bottom: 15 })
          .backgroundColor('#f8f9fa')
      }

      // å‹ç¼©è¯¦æƒ…
      Column({ space: 10 }) {
        // å›¾ç‰‡å°ºå¯¸
        if (this.compressInfo?.imageWidth && this.compressInfo?.imageHeight) {
          Row() {
            Text('ğŸ“ å›¾ç‰‡å°ºå¯¸:')
              .fontSize(14)
              .fontColor('#7f8c8d')
              .width('30%')
            Text(`${this.compressInfo.imageWidth} Ã— ${this.compressInfo.imageHeight}`)
              .fontSize(14)
              .fontWeight(FontWeight.Medium)
          }
          .width('100%')
          .alignItems(VerticalAlign.Center)
        }

        // åŸå§‹å¤§å°
        Row() {
          Text('ğŸ“ åŸå§‹å¤§å°:')
            .fontSize(14)
            .fontColor('#7f8c8d')
            .width('30%')
          Text(LubanUtils.formatFileSize(this.compressInfo!.originalSize))
            .fontSize(14)
            .fontWeight(FontWeight.Medium)
            .fontColor('#e74c3c')
        }
        .width('100%')
        .alignItems(VerticalAlign.Center)

        // å‹ç¼©åå¤§å°
        Row() {
          Text('ğŸ“¦ å‹ç¼©å:')
            .fontSize(14)
            .fontColor('#7f8c8d')
            .width('30%')
          Text(LubanUtils.formatFileSize(this.compressInfo!.compressedSize))
            .fontSize(14)
            .fontWeight(FontWeight.Medium)
            .fontColor('#27ae60')
        }
        .width('100%')
        .alignItems(VerticalAlign.Center)

        // å‹ç¼©æ¯”
        Row() {
          Text('ğŸ“Š å‹ç¼©æ¯”:')
            .fontSize(14)
            .fontColor('#7f8c8d')
            .width('30%')
          Text(`${this.compressInfo!.compressionRatio}%`)
            .fontSize(16)
            .fontWeight(FontWeight.Bold)
            .fontColor('#f39c12')
        }
        .width('100%')
        .alignItems(VerticalAlign.Center)

        // èŠ‚çœç©ºé—´
        Row() {
          Text('ğŸ’¾ èŠ‚çœç©ºé—´:')
            .fontSize(14)
            .fontColor('#7f8c8d')
            .width('30%')
          Text(LubanUtils.formatFileSize(this.compressInfo!.originalSize - this.compressInfo!.compressedSize))
            .fontSize(14)
            .fontWeight(FontWeight.Medium)
            .fontColor('#9b59b6')
        }
        .width('100%')
        .alignItems(VerticalAlign.Center)

        // æ–‡ä»¶è·¯å¾„
        Divider().margin({ top: 10, bottom: 10 })

        Column({ space: 5 }) {
          Text('ğŸ“ å‹ç¼©åè·¯å¾„:')
            .fontSize(12)
            .fontColor('#7f8c8d')
            .alignSelf(ItemAlign.Start)
          Text(this.compressInfo!.compressedPath)
            .fontSize(11)
            .fontColor('#34495e')
            .textOverflow({ overflow: TextOverflow.Ellipsis })
            .maxLines(2)
        }
        .width('100%')
        .alignItems(HorizontalAlign.Start)
      }
      .width('100%')
      .padding(15)
    }
    .width('100%')
    .backgroundColor('#ffffff')
    .borderRadius(12)
    .shadow({
      radius: 8,
      color: '#e0e0e0',
      offsetX: 0,
      offsetY: 2
    })
    .margin({ bottom: 20 })
    .padding(16)
  }

  // æ„å»ºä½¿ç”¨è¯´æ˜
  @Builder
  buildInstructions() {
    Column() {
      Text('ğŸ“– ä½¿ç”¨è¯´æ˜')
        .fontSize(16)
        .fontWeight(FontWeight.Bold)
        .alignSelf(ItemAlign.Start)
        .margin({ bottom: 10, top: 20 })
        .fontColor('#2c3e50')

      Column({ space: 8 }) {
        Text('ğŸ“· "å•å›¾é€‰æ‹©" - ä»ç›¸å†Œé€‰æ‹©å•å¼ å›¾ç‰‡æˆ–æ‹ç…§å‹ç¼©')
          .fontSize(13)
          .fontColor('#7f8c8d')
          .lineHeight(20)
        Text('ğŸ–¼ï¸ "å¤šå›¾é€‰æ‹©" - æ‰¹é‡é€‰æ‹©æœ€å¤š5å¼ å›¾ç‰‡åŒæ—¶å‹ç¼©')
          .fontSize(13)
          .fontColor('#7f8c8d')
          .lineHeight(20)
        Text('ğŸ“± "ä»…æ‹ç…§" - ç›´æ¥æ‹ç…§å¹¶å‹ç¼©ï¼ˆæ”¯æŒç¼–è¾‘ï¼‰')
          .fontSize(13)
          .fontColor('#7f8c8d')
          .lineHeight(20)
        Text('ğŸ” ä½¿ç”¨ä¸“ä¸šçš„ photoAccessHelper API')
          .fontSize(13)
          .fontColor('#7f8c8d')
          .lineHeight(20)
        Text('ğŸ”„ è‡ªåŠ¨å¤„ç†ç›¸å†Œå›¾ç‰‡æƒé™é™åˆ¶ï¼ˆå¤åˆ¶åˆ°ç¼“å­˜ï¼‰')
          .fontSize(13)
          .fontColor('#7f8c8d')
          .lineHeight(20)
        Text('ğŸ§¹ æ”¯æŒä¸´æ—¶ç¼“å­˜æ¸…ç†å’Œå†…å­˜ç®¡ç†')
          .fontSize(13)
          .fontColor('#7f8c8d')
          .lineHeight(20)
        Text('âœ… æ”¯æŒ JPGã€PNGã€WebP ç­‰å¸¸è§æ ¼å¼å’Œ URI')
          .fontSize(13)
          .fontColor('#7f8c8d')
          .lineHeight(20)
      }
      .alignItems(HorizontalAlign.Start)
      .width('100%')
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#f8f9fa')
    .borderRadius(8)
    .margin({ top: 10 })
  }

  /**
   * é€‰æ‹©å•å¼ å›¾ç‰‡å¹¶å‹ç¼©
   */
  private async selectSingleImageAndCompress() {
    try {
      this.isCompressing = true
      this.clearResult()

      console.log('ğŸ” ä½¿ç”¨ PhotoHelper é€‰æ‹©å•å¼ å›¾ç‰‡...');
      const selectedImageUri = await PhotoHelper.selectSingle(true, true);

      if (selectedImageUri) {
        console.log('âœ… é€‰æ‹©äº†å›¾ç‰‡:', selectedImageUri);
        await this.processImageCompression(selectedImageUri);
      } else {
        console.log('âŒ ç”¨æˆ·å–æ¶ˆäº†é€‰æ‹©');
        this.isCompressing = false;
      }
    } catch (error) {
      this.handleCompressError(error as Error)
    }
  }

  /**
   * é€‰æ‹©å¤šå¼ å›¾ç‰‡å¹¶æ‰¹é‡å‹ç¼©
   */
  private async selectMultipleImagesAndCompress() {
    try {
      this.isCompressing = true
      this.clearResult()

      console.log('ğŸ” ä½¿ç”¨ PhotoHelper é€‰æ‹©å¤šå¼ å›¾ç‰‡...');
      const selectedImageUris = await PhotoHelper.selectMultiple(5, true, true);

      if (selectedImageUris.length > 0) {
        console.log(`âœ… é€‰æ‹©äº† ${selectedImageUris.length} å¼ å›¾ç‰‡:`, selectedImageUris);
        
        // æ˜¾ç¤ºç¬¬ä¸€å¼ å›¾ç‰‡ä½œä¸ºé¢„è§ˆ
        this.selectedImageUri = selectedImageUris[0];
        
        // æ‰§è¡Œæ‰¹é‡å‹ç¼©
        await this.processBatchCompression(selectedImageUris);
      } else {
        console.log('âŒ ç”¨æˆ·å–æ¶ˆäº†é€‰æ‹©');
        this.isCompressing = false;
      }
    } catch (error) {
      this.handleCompressError(error as Error)
    }
  }

  /**
   * ä»…æ‹ç…§å¹¶å‹ç¼©
   */
  private async takePhotoAndCompress() {
    try {
      this.isCompressing = true
      this.clearResult()

      console.log('ğŸ“· ä½¿ç”¨ PhotoHelper æ‹ç…§...');
      const photoUri = await PhotoHelper.takePhoto(true);

      if (photoUri) {
        console.log('âœ… æ‹ç…§æˆåŠŸ:', photoUri);
        await this.processImageCompression(photoUri);
      } else {
        console.log('âŒ ç”¨æˆ·å–æ¶ˆäº†æ‹ç…§');
        this.isCompressing = false;
      }
    } catch (error) {
      this.handleCompressError(error as Error)
    }
  }

  /**
   * å¤„ç†æ‰¹é‡å›¾ç‰‡å‹ç¼©
   */
  private async processBatchCompression(imageUris: Array<string>) {
    try {
      console.log(`ğŸš€ å¼€å§‹æ‰¹é‡å‹ç¼© ${imageUris.length} å¼ å›¾ç‰‡...`);
      
      let compressedCount = 0;
      let totalOriginalSize = 0;
      let totalCompressedSize = 0;

      // è·å–ç¬¬ä¸€å¼ å›¾ç‰‡çš„è¯¦ç»†ä¿¡æ¯ç”¨äºæ˜¾ç¤º
      const firstImageUri = imageUris[0];
      const firstImageOriginalSize = await LubanUtils.getFileSizeInBytes(firstImageUri);
      let imageWidth = 0;
      let imageHeight = 0;

      // è·å–ç¬¬ä¸€å¼ å›¾ç‰‡å°ºå¯¸
      try {
        const imageSource = image.createImageSource(firstImageUri);
        const imageInfo = await imageSource.getImageInfo();
        imageWidth = imageInfo.size.width;
        imageHeight = imageInfo.size.height;
        console.log(`ğŸ“ ç¬¬ä¸€å¼ å›¾ç‰‡å°ºå¯¸: ${imageWidth} Ã— ${imageHeight}`);
      } catch (error) {
        console.warn('è·å–å›¾ç‰‡ä¿¡æ¯å¤±è´¥:', error);
      }

      // æ‰§è¡Œæ‰¹é‡å‹ç¼©
      await Luban.with(imageUris)
        .ignoreBy(50)
        .setFocusAlpha(false)
        .filter(LubanUtils.FILTERS.EXCLUDE_GIF)
        .onStart(() => {
          console.log(`ğŸš€ æ‰¹é‡å‹ç¼©å¼€å§‹ - å…± ${imageUris.length} å¼ å›¾ç‰‡`);
        })
        .onSuccess((filePath: string) => {
          compressedCount++;
          console.log(`âœ… æ‰¹é‡å‹ç¼©è¿›åº¦: ${compressedCount}/${imageUris.length} - ${filePath}`);
          
          // å¦‚æœæ˜¯ç¬¬ä¸€å¼ å›¾ç‰‡ï¼Œè®°å½•å…¶å‹ç¼©ä¿¡æ¯ç”¨äºæ˜¾ç¤º
          if (compressedCount === 1) {
            const compressedSize = fileIo.statSync(filePath).size;
            const ratio = LubanUtils.calculateCompressionRatio(firstImageOriginalSize, compressedSize);
            
            this.compressInfo = {
              originalPath: firstImageUri,
              compressedPath: filePath,
              originalSize: firstImageOriginalSize,
              compressedSize: compressedSize,
              compressionRatio: ratio,
              imageWidth: imageWidth,
              imageHeight: imageHeight
            };
          }
          
          // å¦‚æœå…¨éƒ¨å®Œæˆï¼Œæ˜¾ç¤ºæ±‡æ€»ä¿¡æ¯
          if (compressedCount === imageUris.length) {
            console.log(`ğŸ‰ æ‰¹é‡å‹ç¼©å®Œæˆ! æˆåŠŸå‹ç¼© ${compressedCount} å¼ å›¾ç‰‡`);
            this.isCompressing = false;
          }
        })
        .onError((error: Error) => {
          console.error(`âŒ æ‰¹é‡å‹ç¼©å¤±è´¥:`, error.message);
          this.handleCompressError(error);
        })
        .launch();

    } catch (error) {
      this.handleCompressError(error as Error);
    }
  }

  /**
   * å¤„ç†å›¾ç‰‡å‹ç¼©
   */
  private async processImageCompression(imageUri: string) {
    try {
      this.selectedImageUri = imageUri;
      console.log('ğŸ”„ å¼€å§‹å¤„ç†å›¾ç‰‡ URI:', imageUri);

      // æµ‹è¯• URI å¤„ç†åŠŸèƒ½
      const testResult = LubanUtils.testUriHandling(imageUri);
      console.log('ğŸ§ª URI æµ‹è¯•ç»“æœ:', testResult);

      // è·å–åŸå›¾ä¿¡æ¯
      const originalSize = await LubanUtils.getFileSizeInBytes(imageUri);
      let imageWidth = 0;
      let imageHeight = 0;

      // è·å–å›¾ç‰‡å°ºå¯¸ - ç›´æ¥ä½¿ç”¨ URIï¼Œå› ä¸º image API å¯ä»¥å¤„ç† file:// URI
      try {
        const imageSource = image.createImageSource(imageUri);
        const imageInfo = await imageSource.getImageInfo();
        imageWidth = imageInfo.size.width;
        imageHeight = imageInfo.size.height;
        console.log(`ğŸ“ å›¾ç‰‡å°ºå¯¸: ${imageWidth} Ã— ${imageHeight}`);
      } catch (error) {
        console.warn('è·å–å›¾ç‰‡ä¿¡æ¯å¤±è´¥:', error);
      }

      // ä½¿ç”¨ Luban å‹ç¼©å›¾ç‰‡ - æ–°çš„å‡½æ•°ç›‘å¬å™¨æ–¹å¼
      await Luban.with(imageUri)
        .ignoreBy(50) // å¿½ç•¥å°äº 50KB çš„æ–‡ä»¶
        .setFocusAlpha(false) // ä¸ä¿ç•™é€æ˜é€šé“
        .filter(LubanUtils.FILTERS.EXCLUDE_GIF)
        .onStart(() => {
          console.log('ğŸš€ å¼€å§‹å‹ç¼©å›¾ç‰‡...');
          console.log(`ğŸ“ åŸå›¾å°ºå¯¸: ${imageWidth} Ã— ${imageHeight}`);
          console.log(`ğŸ“ åŸå›¾å¤§å°: ${LubanUtils.formatFileSize(originalSize)}`);
          // UI çŠ¶æ€å·²ç»åœ¨å¤–å±‚è®¾ç½®äº† isCompressing = true
        })
        .onSuccess((filePath: string) => {
          console.log('âœ… å‹ç¼©æˆåŠŸ:', filePath);
          const compressedSize = fileIo.statSync(filePath).size;
          const ratio = LubanUtils.calculateCompressionRatio(originalSize, compressedSize);
          console.log(`ğŸ“¦ å‹ç¼©åå¤§å°: ${LubanUtils.formatFileSize(compressedSize)}`);
          console.log(`ğŸ“Š å‹ç¼©æ¯”: ${ratio}%`);
          console.log(`ğŸ’¾ èŠ‚çœç©ºé—´: ${LubanUtils.formatFileSize(originalSize - compressedSize)}`);
          this.handleCompressSuccess(imageUri, filePath, originalSize, imageWidth, imageHeight);
        })
        .onError((error: Error) => {
          console.error('âŒ å‹ç¼©å¤±è´¥:', error.message);
          this.handleCompressError(error);
        })
        .launch();
    } catch (error) {
      this.handleCompressError(error as Error)
    }
  }

  /**
   * å¤„ç†å‹ç¼©æˆåŠŸ
   */
  private handleCompressSuccess(
    originalPath: string,
    compressedFilePath: string,
    originalSize: number,
    imageWidth?: number,
    imageHeight?: number
  ) {
    try {
      const compressedSize = fileIo.statSync(compressedFilePath).size;
      const compressionRatio = LubanUtils.calculateCompressionRatio(originalSize, compressedSize);

      this.compressInfo = {
        originalPath: originalPath,
        compressedPath: compressedFilePath,
        originalSize: originalSize,
        compressedSize: compressedSize,
        compressionRatio: compressionRatio,
        imageWidth: imageWidth,
        imageHeight: imageHeight
      };

      console.log('å‹ç¼©å®Œæˆ:', this.compressInfo);
    } catch (error) {
      this.handleCompressError(new Error(`å‹ç¼©æˆåŠŸï¼Œä½†è·å–æ–‡ä»¶ä¿¡æ¯å¤±è´¥: ${error.message}`));
    } finally {
      this.isCompressing = false;
    }
  }

  /**
   * å¤„ç†å‹ç¼©é”™è¯¯
   */
  private handleCompressError(error: Error) {
    console.error('å‹ç¼©å¤±è´¥:', error);
    this.isCompressing = false;
    // å¯ä»¥åœ¨è¿™é‡Œæ˜¾ç¤ºé”™è¯¯æç¤º
    // æˆ–è€…è®¾ç½®ä¸€ä¸ªé”™è¯¯çŠ¶æ€
  }

  /**
   * æ‰¹é‡å‹ç¼©æ¼”ç¤º
   */
  private showBatchCompressExample() {
    try {
      console.log('ğŸ¯ å¼€å§‹æ‰¹é‡å‹ç¼©æ¼”ç¤º...');

      // æ¨¡æ‹Ÿæ‰¹é‡å›¾ç‰‡è·¯å¾„ï¼ˆå®é™…ä½¿ç”¨æ—¶éœ€è¦çœŸå®çš„å›¾ç‰‡è·¯å¾„ï¼‰
      const imagePaths = [
        this.selectedImageUri,// ä½¿ç”¨å½“å‰é€‰ä¸­çš„å›¾ç‰‡ä½œä¸ºç¤ºä¾‹
      // æ›´å¤šå›¾ç‰‡è·¯å¾„å¯ä»¥æ·»åŠ åœ¨è¿™é‡Œ
      ];

      if (!this.selectedImageUri) {
        console.warn('âš ï¸ è¯·å…ˆé€‰æ‹©ä¸€å¼ å›¾ç‰‡ä½œä¸ºæ‰¹é‡å‹ç¼©çš„ç¤ºä¾‹');
        return;
      }

      // æ‰§è¡Œæ‰¹é‡å‹ç¼© - æ–°çš„å‡½æ•°ç›‘å¬å™¨æ–¹å¼
      Luban.with(imagePaths)
        .ignoreBy(30) // å¿½ç•¥å°äº 30KB çš„æ–‡ä»¶
        .setFocusAlpha(false)
        .filter(LubanUtils.FILTERS.DEFAULT(50)) // ä½¿ç”¨é»˜è®¤è¿‡æ»¤å™¨ï¼Œæ’é™¤GIFä¸”å¤§äº50KB
        .onStart(() => {
          console.log('ğŸš€ æ‰¹é‡å‹ç¼©å¼€å§‹...');
        })
        .onSuccess((filePath: string) => {
          console.log('âœ… æ‰¹é‡å‹ç¼© - æ–‡ä»¶å‹ç¼©æˆåŠŸ:', filePath);
          const fileName = filePath.split('/').pop() || '';
          console.log(`ğŸ“ æ–‡ä»¶å: ${fileName}`);
        })
        .onError((error: Error) => {
          console.error('âŒ æ‰¹é‡å‹ç¼© - æ–‡ä»¶å‹ç¼©å¤±è´¥:', error.message);
        })
        .launch();

      console.log('ğŸ“Š æ‰¹é‡å‹ç¼©ä»»åŠ¡å·²å¯åŠ¨ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—è·å–è¯¦ç»†ä¿¡æ¯');

    } catch (error) {
      console.error('æ‰¹é‡å‹ç¼©æ¼”ç¤ºå¤±è´¥:', error);
    }
  }

  /**
   * æ¸…é™¤ç»“æœ
   */
  private clearResult() {
    this.compressInfo = null;
    this.selectedImageUri = '';
  }

  /**
   * æ¸…ç†ä¸´æ—¶ç¼“å­˜æ–‡ä»¶
   */
  private cleanTempCache() {
    try {
      console.log('ğŸ§¹ å¼€å§‹æ¸…ç†ä¸´æ—¶ç¼“å­˜...');
      const cleanedCount = LubanUtils.cleanTempCache();
      console.log(`âœ… æ¸…ç†å®Œæˆï¼Œåˆ é™¤äº† ${cleanedCount} ä¸ªä¸´æ—¶æ–‡ä»¶`);
      
      // å¯ä»¥åœ¨è¿™é‡Œæ˜¾ç¤ºä¸€ä¸ªç®€å•çš„æç¤ºï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰
      if (cleanedCount > 0) {
        console.log(`ğŸ‰ æˆåŠŸæ¸…ç† ${cleanedCount} ä¸ªä¸´æ—¶æ–‡ä»¶`);
      } else {
        console.log('ğŸ“ ä¸´æ—¶ç¼“å­˜ç›®å½•ä¸ºç©ºï¼Œæ— éœ€æ¸…ç†');
      }
    } catch (error) {
      console.error('âŒ æ¸…ç†ä¸´æ—¶ç¼“å­˜å¤±è´¥:', error);
    }
  }
}